<div class="page" data-name="photo_edit">

	<div class="navbar">
		<div class="navbar-inner">
			<div class="left">
				<a href="#" id="save_change" class="link">
					<i class="icon icon-back"></i>
					<span class="ios-only">Back</span>
				</a>
			</div>
			<div class="title">OP2A Mobile - Editer la photo</div>
			<div class="right">
				<a class="link icon-only"><i class="far fa-bring-forward"></i></a>
				<a class="link icon-only"><i class="far fa-send-backward"></i></a>
				<a class="link icon-only"><i id='savebtn' class="fas fa-save"></i></a>
				<a class="link icon-only"><i id='delbtn' class="fas fa-trash"></i></a>
				<a class="link icon-only"><i id='loadbtn' class="fas fa-retweet"></i></a>
			</div>	
		</div>
	</div>
	<style>
		.demo-list-icon, .icon-f7 {
		  background: #ccc;
		  display: block;
		  position: relative;
		}
		.ios .demo-list-icon {
		  width: 29px;
		  height: 29px;
		  border-radius: 6px;
		  box-sizing: border-box;
		}
		.md .demo-list-icon {
		  width: 24px;
		  height: 24px;
		  border-radius: 4px;
		}
		.aurora .demo-list-icon {
		  width: 18px;
		  height: 18px;
		  border-radius: 4px;
		}
	</style>
	
	<div class="sheet-modal my-sheet-swipe-to-step" style="height:auto; --f7-sheet-bg-color: #fff; background-color: gray;">
	    <div class="sheet-modal-inner">
		    <div class="sheet-modal-swipe-step">
		        <div class="block">
				    <div class="row">
					    <button id='rectbtn' class="col button button-fill sheet-close color-gray"><i class="material-icons" style="margin-top: 5px;">crop_square</i></button><!-- <i class="fal fa-vector-square"></i> -->
					    <button id='circbtn' class="col button button-fill sheet-close color-gray"><i class="material-icons" style="margin-top: 5px;">panorama_fish_eye</i></button>
						<button id='arrowbtn' class="col button button-fill sheet-close color-gray"><i class="material-icons" style="margin-top: 5px;">arrow_forward</i></button>	
						<button id='linebtn' class="col button button-fill sheet-close color-gray"><i class="material-icons" style="margin-top: 5px;">remove</i></button>
						<button id='txtbtn' class="col button button-fill sheet-close color-gray"><i class="material-icons" style="margin-top: 5px;">text_fields</i></button>
					</div>
				</div>
				<div class="list no-hairlines block">
					<div class="row">
						
						<div class="col item-checkbox" style="width: 64px;">
							<label class="item-checkbox item-content">
						        <input id='checkBoxFillColor' onchange="toggleFillColor();" type="checkbox" name="demo-checkbox"/>
<!-- 						        <i class="icon icon-checkbox"></i> -->
									<img id="checkBoxFillColorImage" src="/icon/icon-bring-forward-50.png">
						      </label>
						</div>
						<div class="col item-content item-input" style="width: 64px;">
							<div class="item-media">
								<i class="icon demo-list-icon" id="colorpicker-value"></i>
							</div>
							<div class="item-inner">
								<div class="item-input-wrap">
									<input id='colorpicker' onchange="changeActiveColor();" type="text"  placeholder="Color" readonly="readonly"/>
						        </div>
						    </div>
						</div>
						
						
<!--
						<div class="col item-content item-input" style="width: 64px;">
							<div class="item-media">
								<i class="icon demo-list-icon" id="colorfillpicker-value"></i>
							</div>
							<div class="item-inner" style="display: none;">
								<div class="item-input-wrap">
									<input id="colorfillpicker" onchange="changeFillColor();" type="text" placeholder="Color" readonly="readonly"/>
						        </div>
						    </div>
						</div>
-->
						
						<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/storm.png")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/storm.png" width="40" height="40" style="margin-top: 5px;"></button>
						<button id ="imgbtn_danger" onclick='drawImage(this,"./libs/draw_module/pictures/icons/danger.png")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/danger.png" width="40" height="40" style="margin-top: 5px;"></button>
					</div>
				</div>
				<div id="plus_infos" class="padding-horizontal padding-bottom">
					<div class="margin-top text-align-center" style="color: white;">Glissez vers le haut pour plus d'icons</div>
				</div>
			</div>
			<div class="list no-hairlines block">
				<div class="row">
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/acces-interdit-aux-pietons-ip-2464.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/acces-interdit-aux-pietons-ip-2464.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/charges-suspendues-im-2471.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/charges-suspendues-im-2471.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/chariot-elevateur-im-2472.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/chariot-elevateur-im-2472.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/interdiction-de-charger-ip-2522.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/interdiction-de-charger-ip-2522.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/interdit-d-utiliser-les-telephones-cellulaires-im-2535.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/interdit-d-utiliser-les-telephones-cellulaires-im-2535.jpg" width="40" height="40" style="margin-top: 5px;"></button><!--

					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/ne-pas-deposer-ni-entreposer-ip-2545.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/ne-pas-deposer-ni-entreposer-ip-2545.jpg" width="40" height="40" style="margin-top: 5px;"></button>
-->
				</div>
			</div>
			<div class="list no-hairlines block">
				<div class="row">
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/point-de-rassemblement-celx04-ig-4140.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/point-de-rassemblement-celx04-ig-4140.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/protection-individuelle-obligatoire-contre-les-chutes-im-2565.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/protection-individuelle-obligatoire-contre-les-chutes-im-2565.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Danger Electrique.png")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Danger Electrique.png" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Stationnement interdit - dmeu_y4142992_01_std_lang_all.png")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Stationnement interdit - dmeu_y4142992_01_std_lang_all.png" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Stop - France_road_sign_AB4.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Stop - France_road_sign_AB4.svg" width="40" height="40" style="margin-top: 5px;"></button><!--

					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Accäs camions interdit - France_road_sign_B8.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Accäs camions interdit - France_road_sign_B8.svg" width="40" height="40" style="margin-top: 5px;"></button>
-->
				</div>
			</div>
			<div class="list no-hairlines block">
				<div class="row">
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Accäs interdit piÇton - Pictogram_pedestrian.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Accäs interdit piÇton - Pictogram_pedestrian.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/CÇdez le Passage - France_road_sign_AB3a.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/CÇdez le Passage - France_road_sign_AB3a.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Circulation interdite - France_road_sign_B0.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Circulation interdite - France_road_sign_B0.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Danger France_road_sign_A14.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Danger France_road_sign_A14.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Fläche contournement obligatoire - France_road_sign_B21a1.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Fläche contournement obligatoire - France_road_sign_B21a1.svg" width="40" height="40" style="margin-top: 5px;"></button><!--

					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/France_road_sign_C20a.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/France_road_sign_C20a.svg" width="40" height="40" style="margin-top: 5px;"></button>
-->
				</div>
			</div>
			<div class="list no-hairlines block">
				<div class="row">
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Accäs interdit aux piÇtons - France_road_sign_B9a.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Accäs interdit aux piÇtons - France_road_sign_B9a.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/passage-obligatoire-pour-pietons-iz-2555.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/passage-obligatoire-pour-pietons-iz-2555.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_storm" onclick='drawImage(this,"./libs/draw_module/pictures/icons/acces-interdit-aux-personnes-non-autorisees-im-2463.jpg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/acces-interdit-aux-personnes-non-autorisees-im-2463.jpg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_danger" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Travaux Temporaires - France_road_sign_AK5.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Travaux Temporaires - France_road_sign_AK5.svg" width="40" height="40" style="margin-top: 5px;"></button>
					<button id ="imgbtn_danger" onclick='drawImage(this,"./libs/draw_module/pictures/icons/Sens Interdit - France_road_sign_B1.svg")' class="col button button-large button-raised sheet-close color-gray"><img src="./libs/draw_module/pictures/icons/Sens Interdit - France_road_sign_B1.svg" width="40" height="40" style="margin-top: 5px;"></button>
				</div>
			</div>
			
	    </div>
	</div>

	<div class="page-content">
		<div id="customPopup">
		    <canvas id="canvas" width="1080" height="720"></canvas>
			<div id="imageContainer" style="display:none;">
				<img id='pic0' src='./libs/draw_module/pictures/a.jpg' hidden/>
			</div>
		</div>
	</div>
	
	<script type="text/javascript" ws_script="page">
	ws_engine.register_page("photo_edit", ws_page.extend(
	{	
		custom_init: function(page, event, params)
		{
			var self = this;
			
			self.photo_id = self.params.id;
			
			/*
var colorfillpicker = app.colorPicker.create({
				inputEl: '#colorfillpicker',
				targetEl: '#colorfillpicker-value',
				targetElSetBackgroundColor: true,
				modules: ['wheel'],
				openIn: 'popover',
				value: {
			    	hex: '#00ff00',
				},
			});
*/
			
			var colorpicker = app.colorPicker.create({
				inputEl: '#colorpicker',
				targetEl: '#colorpicker-value',
				targetElSetBackgroundColor: true,
				modules: ['wheel'],
				openIn: 'popover',
				value: {
			    	hex: '#00ff00',
				},
			});
			
			$("#save_change").click(function()
			{
				if(is_saved())
				{
					page.view.router.back();
				}
				else
				{
					downloadButtonEvent().then(function()
					{
						page.view.router.back();
					});
				}
				
				
			});
			
			
			var clickTimer = null;

			function touchStart()
			{
			    if (clickTimer == null)
			    {
			        clickTimer = setTimeout(function ()
			        {
			            clickTimer = null;
			            //Single click
			            
			        }, 300)
			    }
			    else
			    {
			        clearTimeout(clickTimer);
			        clickTimer = null;
			        //Double click
			        //Open sheet modal
			        app.sheet.create({
						el: '.my-sheet-swipe-to-step',
						swipeToClose: true,
						swipeToStep: true,
						backdrop: true,
						on: {
						    opened: function ()
						    {
							    console.log('Sheet opened')
						    },
						    
						    closed: function ()
						    {
								$("#plus_infos").show();
							    console.log('Sheet closed')
						    },
						    
							stepOpen: function()
							{
								$("#plus_infos").hide();
								console.log('Sheet step opened');
						    },
						    stepClose: function()
						    {
								$("#plus_infos").show();
							    console.log('Sheet step closed')
						    },	

						    
						}
					});
					app.sheet.open(".my-sheet-swipe-to-step", true);
			    }
			}
			
			$(".page-content").on("click", touchStart);
			
			
			// Load scripts
			$.getScript("libs/draw_module/palette.js", function()
			{
				console.log("fichier palette est bien charger");
			});
			$.getScript("libs/draw_module/fabrique-objet.js", function()
			{
				console.log("fichier fabrique-objet est bien charger"); 
			});
			
			this.zeroActive();
			
			$("#customPopup").before('<div id="grayBack"></div>');
			
			ws_database.files.get_with_id(self.photo_id).then(function(result)
		    {
			    self.photo = result;
			    op2a_photos.get_photo_as_data_url(result.path).then(function(result)
				{
					self.img_url = result;
					
					if(self.photo.edited == true)
				    {
					    // il faut enlver cette dependance entre l'image et limage editer
					    ws_database.files.get_with_id(JSON.parse(self.photo.transformation).origine_img_id).then(function(result)
						{
							op2a_photos.get_photo_as_data_url(result.path).then(function(result)
							{
								var origine_img_url = result;
								$("#grayBack").css('opacity', 0).fadeTo(300, 0.5, function ()
								{
									$("#customPopup").fadeIn(500); 
									loadButtonEvent(self.photo_id, origine_img_url, self.photo);
									if (self.photo.edited == 0)
									{
										ws_tools.toast("Cliquez deux fois pour ouvrir la liste d'outils.", "top");
										setTimeout(function()
										{
											ws_tools.toast("Choisissez un icon et Cliquez à l'endroit ou vous voulez le mettre.", "top", 3000)
										}, 2500);
									}
									
								});
							});
						});
				    }
				    else
				    {
					    $("#grayBack").css('opacity', 0).fadeTo(300, 0.5, function ()
						{
							$("#customPopup").fadeIn(500); 
							loadButtonEvent(self.photo_id, self.img_url, self.photo);
							if (self.photo.edited == 0)
							{
								ws_tools.toast("Cliquez deux fois pour ouvrir la liste d'outils.", "top");
								setTimeout(function()
								{
									ws_tools.toast("Choisissez votre icon et glissé à l'endroit ou vous voulez le mettre.", "top", 3000)
								}, 2500);
							}
							
						});
				    }
			    });
			    
		     });
		},
		
		zeroActive: function()
		{
			rectActive = false;
			textActive = false;
			lineActive = false;
			arrowActive = false;
			imageActive = false;
			circleActive = false;
			customImageActive = false;
			
			document.getElementById("txtbtn").classList.remove("btn-activated");
			document.getElementById("rectbtn").classList.remove("btn-activated");
			document.getElementById("circbtn").classList.remove("btn-activated");
			document.getElementById("linebtn").classList.remove("btn-activated");
			document.getElementById("arrowbtn").classList.remove("btn-activated");
			//document.getElementById("imgbtn").classList.remove("btn-activated");
		}
	}));
	</script>
</div>
