<div class="page" data-name="projects_list">
	<div class="navbar">
		<div class="navbar-bg"></div>
		<div class="navbar-inner sliding">
            <div class="left">
                <a href="#" class="link back">
                <i class="icon icon-back"></i>
                <span class="if-not-md">Back</span>
                </a>
            </div>
			<div class="title">OSIRI - Liste des projets</div>
		</div>
	</div>
	<div class="page-content">
        
        <script id="osiri_project_template" type="text/template7">
            <div class="list media-list">
                <ul>
                    {{#each projects_list}}
                    <li>
                        <a href="/project/{{ id }}" class="item-content item-link">
                            <div class="item-inner">
                                <div class="item-title-row">
                                    <div class="item-title">{{ nom }}</div>
                                    <div class="item-after">{{ numero }}</div>
                                </div>
                                <div class="item-subtitle">{{ date_debut }}</div>
                            </div>
                        </a>
                    </li>
                    {{/each}}
                </ul>
            </div>
        </script>
		<div id="osiri_projects_list_content"></div>
	</div>
	<script type="text/javascript" ws_script="page">
		ws_engine.register_page("projects_list", ws_page.extend(
		{	
			custom_init: function(page, event, params)
			{
                var self = this;
                
				self.phase = params.phase;
			    self.data = {};

				return self.load_page();
			},
			
			load_page: function()
			{
                var self = this;

                var condition = OSIRI_PROJET_PROPERTY_PHASE + " = ?";
                var binding = [self.phase];

                return ws_database.projets.find(condition, binding).then(function(result)
                {
                    self.data.projects_list = result;

                    return self.apply_template(page, "osiri_project_template", "osiri_projects_list_content", self.data);
                });
			},
			
		}));
	</script>
</div>
